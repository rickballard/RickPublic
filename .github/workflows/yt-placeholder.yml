name: yt-placeholder

on:
  workflow_dispatch:
    inputs:
      episode:
        description: "Episode id (e.g. EP-0001)"
        required: true
        default: "EP-0001"
  pull_request:
    paths:
      - "yt/episodes/**"
      - "yt/scripts/**"
      - "yt/tools/RenderPlaceholder.ps1"

jobs:
  check-and-optional-render:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      - name: Validate episode JSON (schema exists)
        shell: pwsh
        run: |
          $ErrorActionPreference='Stop'
          $ep = "${{ github.event.inputs.episode }}"
          if(-not $ep){ $ep='EP-0001' }
          if(!(Test-Path "yt/episodes/$ep.json")){ throw "Missing yt/episodes/$ep.json" }
          Write-Host "Episode OK: $ep"

      - name: Optional render placeholder (artifact)
        if: ${{ github.event_name == 'workflow_dispatch' }}
        shell: pwsh
        run: |
          $ErrorActionPreference='Stop'
          & pwsh -NoProfile -File "yt/tools/RenderPlaceholder.ps1" -RepoRoot (Get-Location).Path -EpisodeId "${{ github.event.inputs.episode }}"
        id: render

      - name: Upload placeholder artifact
        if: ${{ github.event_name == 'workflow_dispatch' }}
        uses: actions/upload-artifact@v4
        with:
          name: "placeholder-${{ github.event.inputs.episode }}"
          path: yt/out/*
